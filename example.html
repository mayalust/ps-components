<!DOCTYPE html>
<html
    lang="en">
<head>
  <meta
      charset="UTF-8">
  <title>
    Title</title>
  <script src="dist/ps-tree.js"></script>
  <link rel="stylesheet" type="text/css" href="dist/css/ps-tree-basic.css" />
  <link rel="stylesheet" type="text/css" href="dist/css/themes/ps-tree-industry.css" />
  <style>
    body {
      background-color : #eee;
    }
  </style>
</head>
<body>
  <div style = "width : 600px; margin:auto;">
    <div style="padding : 0 0 10px 0;">
      <span>search: </span><input id="key" /><button id="search">submit</button>
    </div>
    <div style="padding : 0 0 10px 0;">
      <input type="checkbox" id="hasLine"/><span>show line: </span>
      <input type="checkbox" id="hasCheckbox"/><span>show checkbox: </span>
      <input type="checkbox" id="pullright"/><span>handler pull right: </span>
      <input type="checkbox" id="condense"/><span>condensed </span>
      <input type="checkbox" id="animation"/><span>animation </span>
    </div>
    <div style="padding : 0 0 10px 0;">
      <span>theme select</span>
      <select id="theme">
        <option value="">basic</option>
        <option value="steel-industry">steel industry</option>
      </select>
    </div>
    <div id="ps-tree" style="max-height : 600px; overflow : auto;"></div>
  </div>
  <!--  -->
  <script>
    function each(arr, callback){
      var i, rs;
      arr = arr || [];
      for(i=0; i<arr.length; i++){
        rs = typeof callback == "function" ? callback(arr[i], i) : undefined;
        if(rs !== undefined){
          return rs;
        }
      }
    }
    function getJSON(url, param, callback){
      var xmlhttp = new XMLHttpRequest();
      param = JSON.stringify(param);
      xmlhttp.onreadystatechange = state_Change;
      xmlhttp.withCredentials = true;
      xmlhttp.open("GET",url,true);
      xmlhttp.send(param);
      function state_Change(){
        if(xmlhttp.readyState == 4){
          if(xmlhttp.status == 200){
            var json = JSON.parse(xmlhttp.responseText);
            callback(json);
          }
        };
      }
    }
    getJSON("china.json", null, function(data){
      var target = [];
      each(data, function(address){
        var addressArr = address.split(",");
        var children = target;
        each(addressArr, function(name, i){
          var find = children.find(function(e){
            return e.label == name;
          })
          if(find){
            children = find.children;
          } else {
            var newAddress = {
              label : name
            }
            i !== addressArr.length - 1 && (newAddress.children = []);
            children.push(newAddress);
            children = newAddress.children;
          }
        })
      });
      var tree = psTree(dom, {
        showline : true,
        animate : false,
        data : target,
        themes : "show-line folder-pull-right show-checkbox",
        on : {
          init : function(event){
            this.open = false;
            this.icon = "circle";
            /**
             var cur = this;
             var group = this.createGroup("group");
             var text = this.createText("a", event.node.label, {
            color : "#aaa"
          });
             var removeBtn = this.createButton("b", "remove", {
            float : "right"
          }, function(e){
            this.remove();
          });
             var addBtn = this.createButton("c", "add", {
            float : "right"
          }, function(e){
            this.append({
              label : "sub000"
            })
          });
             group.appendChild(text);
             group.appendChild(removeBtn);
             group.appendChild(addBtn);
             this.render(group);*/
          },
          click : function(event){
            if(this.children){
              event.preventDefault();
              this.toggle();
            };
            console.log(tree.getSelected(), this.getSelected());
          }
        }
      });
      tree[0].highlight();
    })
    var dom = document.getElementById("ps-tree");
    var search = document.getElementById("search");
    var input = document.getElementById("key");
    var hasline = document.getElementById("hasLine");
    var hasCheckbox = document.getElementById("hasCheckbox");
    var pullright = document.getElementById("pullright");
    var theme = document.getElementById("theme");
    var condense = document.getElementById("condense");
    var animation = document.getElementById("animation");
    var themeCache;
    hasline.setAttribute("checked", "checked");
    pullright.setAttribute("checked", "checked");
    hasCheckbox.setAttribute("checked", "checked");
    themeCache = theme.value = "";
    pullright.onchange = function(e){
      if(this.checked == true){
        tree.addtheme("folder-pull-right");
      } else {
        tree.removetheme("folder-pull-right");
      }
    }
    hasline.onchange = function(e){
      if(this.checked == true){
        tree.addtheme("show-line");
      } else {
        tree.removetheme("show-line");
      }
    }
    hasCheckbox.onchange = function(e){
      if(this.checked == true){
        tree.addtheme("show-checkbox");
      } else {
        tree.removetheme("show-checkbox");
      }
    }
    condense.onchange = function(e){
      if(this.checked == true){
        tree.addtheme("condense");
      } else {
        tree.removetheme("condense");
      }
    }
    search.onclick = function(e){
      tree.search(input.value);
    }
    animation.onchange = function(e){
      tree.setAnimate(this.checked);
    }
    theme.onchange = function(){
      if(typeof themeCache == "string" && themeCache.length > 0){
        tree.removetheme(themeCache);
      };
      tree.addtheme(this.value);
      themeCache = this.value;
    };
  </script>
</body>
</html>